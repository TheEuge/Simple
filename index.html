<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Search Trend Spotter</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f4f4f4;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        input {
            width: 50%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background: #ff0000;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background: #cc0000;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        #loading {
            display: none;
            color: #666;
        }

        #results {
            margin-top: 20px;
        }

        .summary {
            font-size: 16px;
            font-weight: normal;
            margin: 10px 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .error {
            color: red;
        }

        .input-error {
            color: red;
            margin-top: 5px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        #loadJsonInput {
            margin: 10px 0;
        }

        .video-tables {
            display: block;
            flex-direction: row;
            gap: 20px;
            margin-top: 20px;
        }

        .video-table-container {
            flex: 1;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .video-table-container table {
            width: 100%;
            border-collapse: collapse;
        }

        .video-table-container th,
        .video-table-container td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .video-table-container tr:nth-child(even) {
            background-color: #D6EEEE;
        }

        .video-table-container th {
            background-color: #f4f4f4;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .video-table-container h3 {
            margin: 10px;
            font-size: 16px;
            position: sticky;
        }

        .video-table-container a {
            color: #0066cc;
            text-decoration: none;
        }

        .video-table-container a:hover {
            text-decoration: underline;
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
                align-items: flex-start;
            }
            .video-tables {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>YouTube Search Trend Spotter</h1>
        <p><i>Enter two search terms to compare their popularity based on video results, views, and likes, or load a JSON file for offline use.</i></p>

        <input type="text" id="term1" placeholder="Enter first search term (e.g., 'cat videos')" required>
        <input type="text" id="term2" placeholder="Enter second search term (e.g., 'dog videos')" required>
        <div class="button-group">
            <button onclick="compareTerms()">Compare</button>
            <button onclick="downloadJson()" id="downloadJson" disabled>Download JSON</button>
            <input type="file" id="loadJsonInput" accept=".json" onchange="loadJsonFile(event)">
        </div>
        <div id="input-error" class="input-error"></div>
        <div id="loading">Loading results...</div>
        <div id="results"></div>
        <hr>
        <div class="chart-container">
            <h3>Total and Average Metrics Comparison</h3>
            <canvas id="popularityChart"></canvas>
        </div>
        <hr>
        <div class="chart-container">
            <h3>Video Release Dates and Popularity</h3>
            <canvas id="videoChart"></canvas>
        </div>
    </div>

    <script>
        const API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your YouTube Data API key
        const SEARCH_URL = 'https://www.googleapis.com/youtube/v3/search';
        const VIDEOS_URL = 'https://www.googleapis.com/youtube/v3/videos';
        const MAX_RESULTS = 50; // Max per search to avoid quota issues

        let chart; // Global chart instance for bar chart
        let videoChart; // Global chart instance for scatter chart
        let lastFetchedData = null; // Store last fetched data for JSON download

        async function fetchVideoIds(query, type = 'video') {
            const params = new URLSearchParams({
                part: 'id,snippet',
                q: query,
                type: type,
                maxResults: MAX_RESULTS,
                order: 'relevance',
                key: API_KEY
            });
            const response = await fetch(`${SEARCH_URL}?${params}`);
            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            return {
                totalResults: data.pageInfo.totalResults,
                items: data.items.map(item => ({
                    videoId: item.id.videoId, //Extract videoId
                    publishedAt: item.snippet.publishedAt, // Include published date
                    title: item.snippet.title // Include title
                })).filter(item => item.videoId)
            };
        }

        async function fetchVideoStats(videoIds, publishedDates, titles) {
            if (videoIds.length === 0) return { totalViews: 0, totalLikes: 0, count: 0, videos: [] };

            const params = new URLSearchParams({
                part: 'statistics,snippet',
                id: videoIds.join(','),
                key: API_KEY
            });
            const response = await fetch(`${VIDEOS_URL}?${params}`);
            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);

            const videos = data.items.map((item, index) => ({
                videoId: videoIds[index], // Extract videoId
                title: titles[index], // Extract title from search
                viewCount: parseInt(item.statistics.viewCount || 0),
                likeCount: parseInt(item.statistics.likeCount || 0),
                publishedAt: publishedDates[index]
            }));

            const totalViews = videos.reduce((sum, video) => sum + video.viewCount, 0);
            const totalLikes = videos.reduce((sum, video) => sum + video.likeCount, 0);
            return { totalViews, totalLikes, count: videos.length, videos };
        }

        function downloadJson() {
            if (!lastFetchedData) return;

            const dataStr = JSON.stringify(lastFetchedData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `youtube_data_${lastFetchedData.term1}_${lastFetchedData.term2}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadJsonFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    displayResults(data);
                } catch (error) {
                    const results = document.getElementById('results');
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error';
                    errorDiv.textContent = `Error loading JSON file: ${error.message}`;
                    results.appendChild(errorDiv);
                }
            };
            reader.readAsText(file);
        }

        function displayResults(data) {
            const { term1, term2, totalResults1, totalResults2, stats1, stats2 } = data;
            const results = document.getElementById('results');
            results.innerHTML = '';

            // Display summary
            const summary = document.createElement('div');
            summary.innerHTML = `
                <div class="summary">
                    <span style="color:red"><strong><u>${term1}</u>:</strong></span><br>
                    <i><b>Total Videos</b> (Approx):</i><b> ${totalResults1.toLocaleString()} </b><br>
                    <i><b>Top ${stats1.count} Videos</b> - Total Views:</i><b> ${stats1.totalViews.toLocaleString()}</b> (<i>Avg:</i><b> ${Math.round(stats1.totalViews / stats1.count || 0).toLocaleString()})</b><br>
                    <i><b>Total Likes:</b></i><b> ${stats1.totalLikes.toLocaleString()}</b> (<i>Avg:</i><b> ${Math.round(stats1.totalLikes / stats1.count || 0).toLocaleString()})</b></b>
                </div>
                <hr>
                <div class="summary">
                    <span style="color:red"><strong><u>${term2}</u>:</strong></span><br>
                    <i><b>Total Videos</b> (Approx):</i><b> ${totalResults2.toLocaleString()} </b><br>
                    <i><b>Top ${stats2.count} Videos</b> - Total Views:</i><b> ${stats2.totalViews.toLocaleString()}</b> (<i>Avg:</i><b> ${Math.round(stats2.totalViews / stats2.count || 0).toLocaleString()})</b><br>
                    <i><b>Total Likes:</b></i><b> ${stats2.totalLikes.toLocaleString()}</b> (<i>Avg:</i><b> ${Math.round(stats2.totalLikes / stats2.count || 0).toLocaleString()})</b></b>
                </div>
                <p><strong><i>Popularity Insight</i>:</strong><b><span style="color:red"> ${totalResults1 > totalResults2 ? term1 : term2} </span></b> has more total videos. <b><span style="color:red">${stats1.totalViews > stats2.totalViews ? term1 : term2}</span></b> has higher total views. <b><span style="color:red">${stats1.totalLikes > stats2.totalLikes ? term1 : term2}</span></b> has more likes.</p><hr>
            `;
            results.appendChild(summary);

            // Create bar chart for total and average metrics
            const ctx = document.getElementById('popularityChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [term1, term2],
                    datasets: [
                        {
                            label: 'Total Videos (Approx)',
                            data: [totalResults1 / 1e3, totalResults2 / 1e3],
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Total Views (Millions)',
                            data: [stats1.totalViews / 1e6, stats2.totalViews / 1e6],
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Average Views',
                            data: [(stats1.totalViews / stats1.count || 0) / 1e3, (stats2.totalViews / stats2.count || 0) / 1e3],
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Total Likes (Millions)',
                            data: [stats1.totalLikes / 1e6, stats2.totalLikes / 1e6],
                            backgroundColor: 'rgba(153, 102, 255, 0.6)',
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Average Likes',
                            data: [(stats1.totalLikes / stats1.count || 0) / 1e3, (stats2.totalLikes / stats2.count || 0) / 1e3],
                            backgroundColor: 'rgba(255, 159, 64, 0.6)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Total Videos (Thousands)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'Views/Likes (Millions or Thousands)' }
                        }
                    },
                    plugins: {
                        legend: { display: true }
                    }
                }
            });

            // Create scatter chart for video release dates and popularity
            const videoCtx = document.getElementById('videoChart').getContext('2d');
            if (videoChart) videoChart.destroy();
            videoChart = new Chart(videoCtx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: `${term1} Video Views`,
                            data: stats1.videos.map(video => ({
                                x: new Date(video.publishedAt),
                                y: video.viewCount / 1e6
                            })),
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            pointRadius: 5
                        },
                        {
                            label: `${term2} Video Views`,
                            data: stats2.videos.map(video => ({
                                x: new Date(video.publishedAt),
                                y: video.viewCount / 1e6
                            })),
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            pointRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'time',
                            time: { unit: 'month' },
                            title: { display: true, text: 'Release Date' }
                        },
                        y: {
                            title: { display: true, text: 'Views (Millions)' },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: { display: true, text: 'Video Release Dates and Popularity' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const date = new Date(context.raw.x).toLocaleDateString();
                                    const views = context.raw.y.toFixed(2);
                                    return `${context.dataset.label}: ${date}, ${views}M views`;
                                }
                            }
                        }
                    }
                }
            });

            // Display top 50 latest videos in tables
            const videoTables = document.createElement('div');
            videoTables.className = 'video-tables';
            videoTables.innerHTML = `<h3>Top 50 Latest Videos</h3>`;

            // Table for term1
            const tableContainer1 = document.createElement('div');
            tableContainer1.className = 'video-table-container';
            tableContainer1.innerHTML = `<h3>${term1}</h3>`;
            const table1 = document.createElement('table');
            table1.innerHTML = `
                <tr>
                    <th>${term1}</th>
                    <th>Release Date</th>
                    <th>View Count</th>
                </tr>
            `;
            stats1.videos.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt)).slice(0, 50).forEach(video => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><a href="https://youtu.be/${video.videoId}" target="_blank">${video.title}</a></td>
                    <td>${new Date(video.publishedAt).toLocaleDateString()}</td>
                    <td>${video.viewCount.toLocaleString()}</td>
                `;
                table1.appendChild(tr);
            });
            tableContainer1.appendChild(table1);

            // Table for term2
            const tableContainer2 = document.createElement('div');
            tableContainer2.className = 'video-table-container';
            tableContainer2.innerHTML = `<h3>${term2}</h3>`;
            const table2 = document.createElement('table');
            table2.innerHTML = `
                <tr>
                    <th>${term2}</th>
                    <th>Release Date</th>
                    <th>View Count</th>
                </tr>
            `;
            stats2.videos.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt)).slice(0, 50).forEach(video => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><a href="https://youtu.be/${video.videoId}" target="_blank">${video.title}</a></td>
                    <td>${new Date(video.publishedAt).toLocaleDateString()}</td>
                    <td>${video.viewCount.toLocaleString()}</td>
                `;
                table2.appendChild(tr);
            });
            tableContainer2.appendChild(table2);

            videoTables.appendChild(tableContainer1);
            videoTables.appendChild(tableContainer2);
            results.appendChild(videoTables);
        }

        async function compareTerms() {
            const term1 = document.getElementById('term1').value.trim();
            const term2 = document.getElementById('term2').value.trim();
            const inputError = document.getElementById('input-error');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const button = document.querySelector('button');
            const downloadButton = document.getElementById('downloadJson');

            // Clear previous error message
            inputError.textContent = '';

            // Check for missing search terms
            if (!term1 || !term2) {
                inputError.textContent = 'Please enter both search terms.';
                return;
            }

            loading.style.display = 'block';
            results.innerHTML = '';
            button.disabled = true;
            button.textContent = 'Comparing...';
            downloadButton.disabled = true;

            try {
                // Fetch for term1
                const { totalResults: totalResults1, items: items1 } = await fetchVideoIds(term1);
                const videoIds1 = items1.map(item => item.videoId);
                const publishedDates1 = items1.map(item => item.publishedAt);
                const titles1 = items1.map(item => item.title);
                const stats1 = await fetchVideoStats(videoIds1, publishedDates1, titles1);

                // Fetch for term2
                const { totalResults: totalResults2, items: items2 } = await fetchVideoIds(term2);
                const videoIds2 = items2.map(item => item.videoId);
                const publishedDates2 = items2.map(item => item.publishedAt);
                const titles2 = items2.map(item => item.title);
                const stats2 = await fetchVideoStats(videoIds2, publishedDates2, titles2);

                // Structure data for JSON
                lastFetchedData = {
                    term1,
                    term2,
                    totalResults1,
                    totalResults2,
                    stats1,
                    stats2
                };

                // Enable download button
                downloadButton.disabled = false;

                // Display results
                displayResults(lastFetchedData);

            } catch (error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.textContent = `Error: ${error.message}. Check your API key or quota.`;
                results.appendChild(errorDiv);
            } finally {
                loading.style.display = 'none';
                button.disabled = false;
                button.textContent = 'Compare';
            }
        }
    </script>
</body>

</html>